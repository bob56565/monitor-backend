<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitor Health ‚Äî Premium Health Intelligence v3.8.0</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    :root {
      --bg: linear-gradient(135deg, #FDFBF9 0%, #F5F3F0 100%);
      --card: rgba(255,255,255,0.75);
      --card-solid: #FFFFFF;
      --text: #2D3436;
      --muted: #636e72;
      --line: rgba(45,52,54,0.08);
      --sage: #4A7C59;
      --sage-light: rgba(74,124,89,0.08);
      --sage-glow: rgba(74,124,89,0.25);
      --coral: #E07A5F;
      --coral-light: rgba(224,122,95,0.08);
      --blue: #4A6FA5;
      --blue-light: rgba(74,111,165,0.08);
      --purple: #7B68EE;
      --purple-light: rgba(123,104,238,0.08);
      --gold: #D4A853;
      --gold-light: rgba(212,168,83,0.1);
      --shadow: 0 8px 32px rgba(0,0,0,0.08);
      --shadow-hover: 0 16px 48px rgba(0,0,0,0.12);
      --glass: rgba(255,255,255,0.7);
      --glass-border: rgba(255,255,255,0.3);
      --radius: 24px;
      --radius-sm: 16px;
      --radius-pill: 50px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }
    .container { max-width: 1280px; margin: 0 auto; padding: 0 32px; }
    
    /* GLASSMORPHISM BASE */
    .glass {
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow), inset 0 1px 1px rgba(255,255,255,0.6);
    }
    
    /* HEADER */
    header {
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--line);
      position: sticky;
      top: 0;
      z-index: 100;
      animation: slideDown 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: none; opacity: 1; } }
    .header-inner { height: 80px; display: flex; align-items: center; justify-content: space-between; }
    .brand { display: flex; align-items: center; gap: 14px; font-weight: 600; font-size: 20px; }
    .brand-mark {
      width: 48px; height: 48px; border-radius: 16px;
      background: linear-gradient(135deg, var(--sage) 0%, #6BA07A 100%);
      color: white; display: grid; place-items: center; font-weight: 700; font-size: 18px;
      box-shadow: 0 4px 12px var(--sage-glow);
    }
    .nav { display: flex; gap: 24px; align-items: center; }
    .nav a { color: var(--muted); text-decoration: none; font-size: 14px; font-weight: 500; transition: color 0.2s; }
    .nav a:hover { color: var(--sage); }
    .version { background: linear-gradient(135deg, var(--sage-light), rgba(74,124,89,0.15)); color: var(--sage); padding: 8px 18px; border-radius: var(--radius-pill); font-size: 13px; font-weight: 600; }

    /* HERO */
    .hero { padding: 80px 0 48px; position: relative; overflow: hidden; }
    .hero::before {
      content: ''; position: absolute; top: -50%; right: -20%; width: 80%; height: 200%;
      background: radial-gradient(circle, rgba(74,124,89,0.08) 0%, transparent 60%);
      animation: pulse 8s ease-in-out infinite;
    }
    @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.5; } 50% { transform: scale(1.1); opacity: 0.8; } }
    .hero-content { position: relative; z-index: 1; }
    .eyebrow {
      display: inline-flex; align-items: center; gap: 10px;
      background: var(--glass); backdrop-filter: blur(10px);
      border: 1px solid rgba(74,124,89,0.2);
      color: var(--sage); padding: 10px 20px; border-radius: var(--radius-pill);
      font-size: 12px; font-weight: 600; letter-spacing: 0.1em; text-transform: uppercase;
      margin-bottom: 24px;
      animation: fadeUp 0.6s ease 0.1s both;
    }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: none; } }
    h1 { font-size: clamp(40px, 5vw, 56px); font-weight: 700; line-height: 1.1; letter-spacing: -0.03em; margin-bottom: 20px; animation: fadeUp 0.6s ease 0.2s both; }
    h1 span { background: linear-gradient(135deg, var(--sage) 0%, #6BA07A 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .hero p { font-size: 18px; color: var(--muted); max-width: 600px; margin-bottom: 32px; animation: fadeUp 0.6s ease 0.3s both; }
    .hero-actions { display: flex; gap: 16px; flex-wrap: wrap; animation: fadeUp 0.6s ease 0.4s both; }
    
    /* BUTTONS - PILL SHAPED */
    .btn {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 18px 32px; border-radius: var(--radius-pill); font-size: 15px; font-weight: 600;
      cursor: pointer; border: none; font-family: inherit;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--sage) 0%, #5D9A6F 100%);
      color: white;
      box-shadow: 0 4px 20px var(--sage-glow), 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn-primary:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 32px var(--sage-glow), 0 4px 8px rgba(0,0,0,0.1); }
    .btn-secondary {
      background: var(--glass); backdrop-filter: blur(10px);
      color: var(--text); border: 1px solid var(--line);
    }
    .btn-secondary:hover { background: white; transform: translateY(-2px); box-shadow: var(--shadow); }
    .btn-coral {
      background: linear-gradient(135deg, var(--coral) 0%, #D9694D 100%);
      color: white;
      box-shadow: 0 4px 20px rgba(224,122,95,0.3);
    }
    .btn-coral:hover { transform: translateY(-3px) scale(1.02); }

    /* LAYOUT */
    main { padding: 32px 0 100px; }
    .grid { display: grid; grid-template-columns: 420px 1fr; gap: 40px; align-items: start; }
    @media (max-width: 1100px) { .grid { grid-template-columns: 1fr; } .sidebar { position: static !important; } }

    /* CARDS - GLASSMORPHISM */
    .card {
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius);
      box-shadow: var(--shadow), inset 0 1px 1px rgba(255,255,255,0.6);
      border: 1px solid var(--glass-border);
      transition: all 0.3s ease;
    }
    .card:hover { box-shadow: var(--shadow-hover); }
    .card-head { padding: 20px 26px; border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center; }
    .card-title { font-size: 11px; font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); }
    .card-body { padding: 26px; }

    /* SIDEBAR */
    .sidebar { position: sticky; top: 100px; animation: fadeUp 0.6s ease 0.5s both; }
    
    /* WIZARD STEPS */
    .wizard-nav { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
    .wizard-step {
      padding: 10px 18px; border-radius: var(--radius-pill); font-size: 13px; font-weight: 600;
      background: var(--bg); color: var(--muted); cursor: pointer; transition: all 0.2s;
      border: 1px solid transparent;
    }
    .wizard-step:hover { background: white; }
    .wizard-step.active { background: var(--sage); color: white; }
    .wizard-step.completed { background: var(--sage-light); color: var(--sage); border-color: var(--sage); }
    
    /* FORM SECTIONS */
    .form-section { display: none; animation: fadeUp 0.4s ease; }
    .form-section.active { display: block; }
    .sec { margin-bottom: 24px; }
    .sec-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
    .sec-title { font-size: 13px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 10px; }
    .sec-badge { background: linear-gradient(135deg, var(--sage-light), rgba(74,124,89,0.15)); padding: 5px 12px; border-radius: var(--radius-pill); font-size: 11px; font-weight: 600; color: var(--sage); }
    .inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .inputs.single { grid-template-columns: 1fr; }
    .inputs.triple { grid-template-columns: 1fr 1fr 1fr; }
    
    /* INPUT FIELDS - PREMIUM */
    .field { position: relative; }
    .field label { display: block; font-size: 11px; font-weight: 600; color: var(--muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.05em; }
    .field input, .field select, .field textarea {
      width: 100%; padding: 16px 18px; 
      border: 2px solid rgba(74,124,89,0.12);
      border-radius: var(--radius-sm); font-size: 14px; 
      background: rgba(255,255,255,0.9);
      transition: all 0.3s ease;
      font-family: inherit;
    }
    .field input:focus, .field select:focus, .field textarea:focus {
      outline: none;
      border-color: var(--sage);
      box-shadow: 0 0 0 4px var(--sage-light), 0 4px 12px var(--sage-glow);
      background: white;
    }
    .field input::placeholder { color: #9CA3AF; }
    
    /* CHECKBOX/TOGGLE */
    .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
    .checkbox-item {
      display: flex; align-items: center; gap: 10px;
      padding: 14px 18px; background: rgba(255,255,255,0.8);
      border-radius: var(--radius-sm); border: 2px solid var(--line);
      font-size: 14px; cursor: pointer; transition: all 0.2s;
    }
    .checkbox-item:hover { border-color: var(--sage); background: white; }
    .checkbox-item.checked { border-color: var(--sage); background: var(--sage-light); }
    .checkbox-item input { display: none; }
    .checkbox-item .check { width: 20px; height: 20px; border-radius: 6px; border: 2px solid var(--line); display: grid; place-items: center; transition: all 0.2s; }
    .checkbox-item.checked .check { background: var(--sage); border-color: var(--sage); color: white; }
    
    /* MULTI-SELECT CHIPS */
    .chip-select { display: flex; flex-wrap: wrap; gap: 8px; }
    .chip {
      padding: 10px 16px; border-radius: var(--radius-pill);
      background: rgba(255,255,255,0.8); border: 2px solid var(--line);
      font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s;
    }
    .chip:hover { border-color: var(--sage); }
    .chip.selected { background: var(--sage); color: white; border-color: var(--sage); }
    
    /* SLIDER */
    .slider-container { padding: 10px 0; }
    .slider { width: 100%; height: 8px; border-radius: 4px; background: var(--line); appearance: none; cursor: pointer; }
    .slider::-webkit-slider-thumb { appearance: none; width: 24px; height: 24px; border-radius: 50%; background: var(--sage); box-shadow: 0 2px 8px var(--sage-glow); cursor: pointer; }
    .slider-labels { display: flex; justify-content: space-between; font-size: 11px; color: var(--muted); margin-top: 8px; }
    
    /* SYMPTOM GRID */
    .symptom-category { margin-bottom: 20px; }
    .symptom-category h5 { font-size: 12px; font-weight: 700; color: var(--text); margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .symptom-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 8px; }
    .symptom-item {
      padding: 10px 14px; border-radius: 12px;
      background: rgba(255,255,255,0.8); border: 1px solid var(--line);
      font-size: 12px; cursor: pointer; transition: all 0.2s; text-align: center;
    }
    .symptom-item:hover { border-color: var(--coral); background: white; }
    .symptom-item.selected { background: var(--coral-light); border-color: var(--coral); color: var(--coral); font-weight: 600; }
    .symptom-duration { margin-top: 10px; display: none; }
    .symptom-item.selected + .symptom-duration { display: block; }

    /* RESULTS */
    .results { display: grid; gap: 32px; }
    .empty { text-align: center; padding: 80px 32px; }
    .empty-icon { font-size: 72px; margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    .empty h3 { font-size: 24px; font-weight: 700; margin-bottom: 12px; }
    .empty p { color: var(--muted); max-width: 400px; margin: 0 auto; }

    /* SECTION HEADERS */
    .section-header { margin-bottom: 24px; }
    .section-header h2 { font-size: 28px; font-weight: 700; margin-bottom: 8px; letter-spacing: -0.02em; }
    .section-header p { color: var(--muted); font-size: 15px; }

    /* COLLAPSIBLE SECTIONS */
    .collapsible { margin-bottom: 28px; }
    .collapsible-header {
      background: var(--glass); backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding: 24px 28px;
      display: flex; justify-content: space-between; align-items: center;
      cursor: pointer; transition: all 0.3s ease;
    }
    .collapsible-header:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
    .collapsible-header h3 { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 14px; }
    .collapsible-header .icon { font-size: 28px; }
    .collapsible-header .arrow { color: var(--muted); transition: transform 0.3s; font-size: 20px; }
    .collapsible.open .collapsible-header .arrow { transform: rotate(180deg); }
    .collapsible-body {
      display: none;
      background: var(--card-solid);
      border: 1px solid var(--line);
      border-top: none;
      border-radius: 0 0 var(--radius) var(--radius);
      padding: 28px;
      margin-top: -20px;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: none; } }
    .collapsible.open .collapsible-body { display: block; }

    /* EXECUTIVE SUMMARY */
    .exec-summary {
      background: linear-gradient(135deg, rgba(74,124,89,0.08) 0%, rgba(74,124,89,0.04) 100%);
      border: 2px solid rgba(74,124,89,0.15);
      border-radius: var(--radius);
      padding: 36px;
      margin-bottom: 32px;
      position: relative;
      overflow: hidden;
    }
    .exec-summary::before {
      content: ''; position: absolute; top: -50%; right: -30%; width: 60%; height: 200%;
      background: radial-gradient(circle, rgba(74,124,89,0.1) 0%, transparent 50%);
    }
    .exec-summary > * { position: relative; z-index: 1; }
    .exec-summary h2 { font-size: 32px; font-weight: 700; margin-bottom: 8px; }
    .exec-summary > p { color: var(--muted); margin-bottom: 28px; font-size: 16px; }
    .exec-stats { display: flex; justify-content: center; gap: 60px; margin-bottom: 28px; padding-bottom: 28px; border-bottom: 1px solid rgba(74,124,89,0.15); }
    .stat-item { text-align: center; }
    .stat-num { font-size: 42px; font-weight: 800; background: linear-gradient(135deg, var(--sage), #6BA07A); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .stat-label { font-size: 13px; color: var(--muted); margin-top: 4px; font-weight: 500; }
    
    .key-findings { margin-bottom: 24px; }
    .key-findings h4 { font-size: 13px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 14px; }
    .finding-item {
      display: flex; align-items: center; gap: 14px;
      padding: 16px 20px; background: white; border-radius: var(--radius-sm);
      margin-bottom: 10px; border: 1px solid var(--line);
      transition: all 0.2s;
    }
    .finding-item:hover { transform: translateX(4px); box-shadow: var(--shadow); }
    .finding-badge { padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; }
    .badge-high { background: linear-gradient(135deg, var(--coral-light), rgba(224,122,95,0.15)); color: #A4513E; }
    .badge-moderate { background: linear-gradient(135deg, var(--gold-light), rgba(212,168,83,0.15)); color: #9A7B3C; }
    .badge-normal { background: linear-gradient(135deg, var(--sage-light), rgba(74,124,89,0.15)); color: var(--sage); }
    .badge-review { background: linear-gradient(135deg, var(--blue-light), rgba(74,111,165,0.15)); color: var(--blue); }

    /* FLIP CARDS */
    .flip-card { perspective: 1000px; height: 200px; cursor: pointer; }
    .flip-card-inner {
      position: relative; width: 100%; height: 100%;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
    }
    .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
    .flip-card-front, .flip-card-back {
      position: absolute; width: 100%; height: 100%;
      backface-visibility: hidden;
      border-radius: var(--radius-sm);
      padding: 20px;
      display: flex; flex-direction: column;
    }
    .flip-card-front { background: white; border: 1px solid var(--line); }
    .flip-card-back { background: linear-gradient(135deg, var(--sage), #5D9A6F); color: white; transform: rotateY(180deg); }
    .flip-card-back h4 { font-size: 14px; font-weight: 700; margin-bottom: 8px; }
    .flip-card-back p { font-size: 12px; line-height: 1.5; opacity: 0.95; }
    .flip-hint { font-size: 10px; color: var(--muted); margin-top: auto; text-align: center; }
    .flip-card.flipped .flip-hint { color: rgba(255,255,255,0.7); }

    /* COVERAGE DASHBOARD */
    .coverage-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 18px; }
    .coverage-item {
      background: white; border: 1px solid var(--line); border-radius: var(--radius-sm);
      padding: 20px; cursor: pointer; transition: all 0.3s ease;
      position: relative; overflow: hidden;
    }
    .coverage-item:hover { transform: translateY(-4px); box-shadow: var(--shadow); }
    .coverage-item h4 { font-size: 14px; font-weight: 700; text-transform: capitalize; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
    .coverage-bar { height: 10px; background: var(--bg); border-radius: 5px; overflow: hidden; margin-bottom: 10px; }
    .coverage-fill { height: 100%; border-radius: 5px; transition: width 1s ease; }
    .coverage-fill.high { background: linear-gradient(90deg, var(--sage), #6BA07A); }
    .coverage-fill.medium { background: linear-gradient(90deg, var(--gold), #E5B963); }
    .coverage-fill.low { background: linear-gradient(90deg, var(--coral), #E99A85); }
    .coverage-stats { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); font-weight: 500; }
    .coverage-detail { margin-top: 12px; font-size: 11px; }
    .coverage-detail .provided { color: var(--sage); font-weight: 600; }
    .coverage-detail .missing { color: var(--muted); margin-top: 4px; }
    .coverage-explanation {
      display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, var(--sage), #5D9A6F);
      color: white; padding: 20px; border-radius: var(--radius-sm);
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .coverage-item.show-explanation .coverage-explanation { display: block; }
    .coverage-explanation h4 { font-size: 13px; margin-bottom: 8px; color: white; }
    .coverage-explanation p { font-size: 11px; line-height: 1.5; opacity: 0.95; }
    .coverage-explanation .close-btn { position: absolute; top: 12px; right: 12px; cursor: pointer; opacity: 0.8; }

    /* IMPACT SCORE TOOLTIP */
    .impact-tooltip {
      position: relative; display: inline-flex; align-items: center; gap: 6px;
      cursor: help;
    }
    .impact-tooltip .tooltip-content {
      display: none; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
      background: var(--text); color: white; padding: 16px 20px; border-radius: 12px;
      font-size: 12px; width: 280px; z-index: 100; margin-bottom: 10px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    .impact-tooltip:hover .tooltip-content { display: block; animation: fadeIn 0.2s ease; }
    .tooltip-content h5 { font-size: 13px; font-weight: 700; margin-bottom: 8px; }
    .tooltip-content p { line-height: 1.5; opacity: 0.9; }

    /* TIER SECTIONS */
    .tier-section { margin-bottom: 28px; }
    .tier-header {
      display: flex; align-items: center; gap: 14px;
      padding: 18px 22px; background: var(--bg); border-radius: var(--radius-sm);
      margin-bottom: 16px; cursor: pointer;
    }
    .tier-header:hover { background: white; }
    .tier-badge { padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 700; letter-spacing: 0.05em; }
    .tier-1 { background: linear-gradient(135deg, var(--sage-light), rgba(74,124,89,0.15)); color: var(--sage); }
    .tier-2 { background: linear-gradient(135deg, var(--blue-light), rgba(74,111,165,0.15)); color: var(--blue); }
    .tier-3 { background: linear-gradient(135deg, var(--purple-light), rgba(123,104,238,0.15)); color: var(--purple); }
    .tier-header h4 { font-size: 15px; font-weight: 700; flex: 1; }
    .tier-count { color: var(--muted); font-size: 13px; font-weight: 500; }
    .tier-explanation {
      background: white; border: 1px solid var(--line); border-radius: var(--radius-sm);
      padding: 18px 22px; margin-bottom: 16px; font-size: 13px; color: var(--muted);
      display: none;
    }
    .tier-section.show-explanation .tier-explanation { display: block; animation: slideIn 0.3s ease; }
    .tier-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 14px; }
    
    /* TIER ITEMS - FLIP */
    .tier-item {
      background: white; border: 1px solid var(--line); border-radius: var(--radius-sm);
      padding: 18px; cursor: pointer; transition: all 0.2s;
      position: relative; min-height: 120px;
    }
    .tier-item:hover { transform: translateY(-2px); box-shadow: var(--shadow); }
    .tier-item-name { font-size: 11px; color: var(--muted); font-weight: 600; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.05em; }
    .tier-item-value { font-size: 26px; font-weight: 800; margin-bottom: 8px; }
    .tier-item-tag { display: inline-block; padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: 700; text-transform: uppercase; }
    .tag-ok { background: var(--sage-light); color: var(--sage); }
    .tag-warn { background: var(--coral-light); color: #A4513E; }
    .tag-neutral { background: var(--bg); color: var(--muted); }
    .tier-item-explanation {
      display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: var(--text); color: white; padding: 16px; border-radius: var(--radius-sm);
      font-size: 11px; line-height: 1.5; overflow: auto;
    }
    .tier-item.show-explanation .tier-item-explanation { display: block; animation: fadeIn 0.2s ease; }
    .tier-item-explanation h5 { font-size: 12px; font-weight: 700; margin-bottom: 6px; }
    .tier-item-explanation .range { margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2); }

    /* TIER COMBINED INTERPRETATION */
    .tier-interpretation {
      background: linear-gradient(135deg, rgba(74,124,89,0.05), rgba(74,124,89,0.02));
      border: 1px solid rgba(74,124,89,0.15);
      border-radius: var(--radius-sm);
      padding: 20px;
      margin-top: 16px;
    }
    .tier-interpretation h5 { font-size: 12px; font-weight: 700; color: var(--sage); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.05em; }
    .tier-interpretation ul { margin-left: 16px; font-size: 13px; }
    .tier-interpretation li { margin-bottom: 6px; }
    .likely { color: var(--sage); font-weight: 600; }
    .unlikely { color: var(--muted); }
    .uncertain { color: var(--gold); }

    /* KEY METRICS - EXPANDABLE */
    .metrics-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 18px; }
    .metric {
      background: white; border: 1px solid var(--line); border-radius: var(--radius-sm);
      padding: 22px; cursor: pointer; transition: all 0.3s ease;
      position: relative;
    }
    .metric:hover { transform: translateY(-4px); box-shadow: var(--shadow); }
    .metric-label { font-size: 11px; color: var(--muted); font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 8px; }
    .metric-value { font-size: 32px; font-weight: 800; margin-bottom: 10px; }
    .metric-tag { display: inline-block; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 700; }
    .metric-expand { font-size: 11px; color: var(--sage); margin-top: 10px; font-weight: 600; }
    
    /* METRIC EXPANDED VIEW */
    .metric-detail {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5); z-index: 1000; place-items: center;
      backdrop-filter: blur(5px);
    }
    .metric-detail.show { display: grid; animation: fadeIn 0.2s ease; }
    .metric-modal {
      background: white; border-radius: var(--radius); padding: 32px;
      max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;
      box-shadow: 0 24px 80px rgba(0,0,0,0.2);
    }
    .metric-modal h3 { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
    .metric-modal .value { font-size: 40px; font-weight: 800; color: var(--sage); margin-bottom: 16px; }
    .metric-modal section { margin-bottom: 24px; }
    .metric-modal section h4 { font-size: 12px; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .metric-modal p { font-size: 14px; line-height: 1.6; color: var(--text); }
    .provider-list { display: grid; gap: 12px; }
    .provider-item {
      display: flex; align-items: center; gap: 14px;
      padding: 16px; background: var(--bg); border-radius: var(--radius-sm);
      transition: all 0.2s;
    }
    .provider-item:hover { background: white; box-shadow: var(--shadow); }
    .provider-icon { width: 44px; height: 44px; border-radius: 12px; background: var(--sage-light); display: grid; place-items: center; font-size: 20px; }
    .provider-info h5 { font-size: 14px; font-weight: 600; }
    .provider-info p { font-size: 12px; color: var(--muted); }
    .provider-rating { margin-left: auto; color: var(--gold); font-weight: 700; }
    .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 12px; }
    .product-item {
      padding: 16px; background: var(--bg); border-radius: var(--radius-sm);
      text-align: center; transition: all 0.2s;
    }
    .product-item:hover { background: white; box-shadow: var(--shadow); }
    .product-item .icon { font-size: 32px; margin-bottom: 8px; }
    .product-item h5 { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
    .product-item p { font-size: 11px; color: var(--muted); }
    .product-item .discount { color: var(--coral); font-weight: 700; font-size: 12px; margin-top: 8px; }
    .resource-links { display: flex; flex-wrap: wrap; gap: 10px; }
    .resource-link {
      padding: 10px 16px; background: var(--blue-light); color: var(--blue);
      border-radius: var(--radius-pill); font-size: 12px; font-weight: 600;
      text-decoration: none; transition: all 0.2s;
    }
    .resource-link:hover { background: var(--blue); color: white; }
    .close-modal {
      position: absolute; top: 20px; right: 20px;
      width: 36px; height: 36px; border-radius: 50%;
      background: var(--bg); border: none; cursor: pointer;
      font-size: 18px; display: grid; place-items: center;
      transition: all 0.2s;
    }
    .close-modal:hover { background: var(--line); }

    /* STATES GRID */
    .states-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 20px; }
    .state-card { padding: 26px; transition: all 0.3s ease; }
    .state-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-hover); }
    .state-header { display: flex; gap: 18px; margin-bottom: 20px; }
    .state-icon { width: 56px; height: 56px; border-radius: 18px; display: grid; place-items: center; font-size: 24px; flex-shrink: 0; }
    .state-icon.ok { background: linear-gradient(135deg, var(--sage-light), rgba(74,124,89,0.15)); }
    .state-icon.warn { background: linear-gradient(135deg, var(--coral-light), rgba(224,122,95,0.15)); }
    .state-name { font-size: 11px; font-weight: 700; color: var(--muted); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 4px; }
    .state-value { font-size: 22px; font-weight: 700; text-transform: capitalize; margin-bottom: 6px; }
    .state-factors { font-size: 13px; color: var(--muted); }
    .state-score { display: inline-block; margin-top: 10px; padding: 6px 14px; background: var(--bg); border-radius: 10px; font-size: 13px; font-weight: 700; }

    /* FOOTER */
    footer { border-top: 1px solid var(--line); padding: 60px 0; background: white; }
    .footer-links { display: flex; justify-content: center; gap: 32px; margin-bottom: 20px; }
    .footer-links a { color: var(--muted); text-decoration: none; font-size: 14px; font-weight: 500; transition: color 0.2s; }
    .footer-links a:hover { color: var(--sage); }
    .disclaimer-footer { max-width: 700px; margin: 0 auto; font-size: 12px; color: var(--muted); text-align: center; line-height: 1.6; }

    .hidden { display: none !important; }
    
    /* SCROLL REVEAL */
    .reveal { opacity: 0; transform: translateY(30px); transition: all 0.6s ease; }
    .reveal.visible { opacity: 1; transform: none; }
  </style>
</head>
<body>
  <header>
    <div class="container header-inner">
      <div class="brand">
        <div class="brand-mark">MH</div>
        <span>Monitor Health</span>
      </div>
      <nav class="nav">
        <a href="https://monitor-api.abedelhamdan.workers.dev/schema" target="_blank">API Schema</a>
        <a href="https://monitor-api.abedelhamdan.workers.dev/citations" target="_blank">Citations</a>
        <span class="version">v3.8.0</span>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container hero-content">
      <span class="eyebrow">üß¨ Premium Health Intelligence</span>
      <h1>Transform partial labs into<br><span>complete clarity</span></h1>
      <p>Enter your biomarkers and health data. We synthesize physiological states, show exactly what traditional labs would reveal, and provide actionable next steps.</p>
      <div class="hero-actions">
        <button class="btn btn-primary" onclick="loadDemo()">‚ú® Load Demo Data</button>
        <button class="btn btn-secondary" onclick="scrollToForm()">üìù Enter My Data</button>
      </div>
    </div>
  </section>

  <main>
    <div class="container grid">
      <aside class="sidebar">
        <div class="card">
          <div class="card-head">
            <span class="card-title">Health Profile</span>
            <span class="sec-badge" id="progress-badge">Step 1/6</span>
          </div>
          <div class="card-body">
            <!-- WIZARD NAVIGATION -->
            <div class="wizard-nav">
              <div class="wizard-step active" data-step="1">Biomarkers</div>
              <div class="wizard-step" data-step="2">Vitals</div>
              <div class="wizard-step" data-step="3">History</div>
              <div class="wizard-step" data-step="4">Lifestyle</div>
              <div class="wizard-step" data-step="5">Symptoms</div>
              <div class="wizard-step" data-step="6">Demographics</div>
            </div>
            
            <form id="healthForm">
              <!-- STEP 1: BIOMARKERS -->
              <div class="form-section active" data-step="1">
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üíâ Lipid Panel</span><span class="sec-badge">4</span></div>
                  <div class="inputs">
                    <div class="field"><label>Total Cholesterol</label><input name="total_cholesterol" type="number" placeholder="mg/dL"></div>
                    <div class="field"><label>HDL</label><input name="hdl" type="number" placeholder="mg/dL"></div>
                    <div class="field"><label>LDL</label><input name="ldl" type="number" placeholder="mg/dL"></div>
                    <div class="field"><label>Triglycerides</label><input name="triglycerides" type="number" placeholder="mg/dL"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üç¨ Metabolic Panel</span><span class="sec-badge">4</span></div>
                  <div class="inputs">
                    <div class="field"><label>Fasting Glucose</label><input name="fasting_glucose" type="number" placeholder="mg/dL"></div>
                    <div class="field"><label>Fasting Insulin</label><input name="fasting_insulin" type="number" step="0.1" placeholder="ŒºIU/mL"></div>
                    <div class="field"><label>HbA1c</label><input name="hba1c" type="number" step="0.1" placeholder="%"></div>
                    <div class="field"><label>Uric Acid</label><input name="uric_acid" type="number" step="0.1" placeholder="mg/dL"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">ü¶¥ Kidney & Liver</span><span class="sec-badge">5</span></div>
                  <div class="inputs">
                    <div class="field"><label>Creatinine</label><input name="creatinine" type="number" step="0.1" placeholder="mg/dL"></div>
                    <div class="field"><label>BUN</label><input name="bun" type="number" placeholder="mg/dL"></div>
                    <div class="field"><label>ALT</label><input name="alt" type="number" placeholder="U/L"></div>
                    <div class="field"><label>AST</label><input name="ast" type="number" placeholder="U/L"></div>
                    <div class="field"><label>GGT</label><input name="ggt" type="number" placeholder="U/L"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üî¨ Inflammatory</span><span class="sec-badge">3</span></div>
                  <div class="inputs">
                    <div class="field"><label>hs-CRP</label><input name="hscrp" type="number" step="0.1" placeholder="mg/L"></div>
                    <div class="field"><label>Ferritin</label><input name="ferritin" type="number" placeholder="ng/mL"></div>
                    <div class="field"><label>Homocysteine</label><input name="homocysteine" type="number" step="0.1" placeholder="Œºmol/L"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üß¨ CBC & Thyroid</span><span class="sec-badge">6</span></div>
                  <div class="inputs">
                    <div class="field"><label>Hemoglobin</label><input name="hemoglobin" type="number" step="0.1" placeholder="g/dL"></div>
                    <div class="field"><label>WBC</label><input name="wbc" type="number" step="0.1" placeholder="K/ŒºL"></div>
                    <div class="field"><label>Platelets</label><input name="platelets" type="number" placeholder="K/ŒºL"></div>
                    <div class="field"><label>TSH</label><input name="tsh" type="number" step="0.01" placeholder="mIU/L"></div>
                    <div class="field"><label>Vitamin D</label><input name="vitamin_d" type="number" placeholder="ng/mL"></div>
                    <div class="field"><label>B12</label><input name="b12" type="number" placeholder="pg/mL"></div>
                  </div>
                </div>
              </div>
              
              <!-- STEP 2: VITALS -->
              <div class="form-section" data-step="2">
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üìä Blood Pressure</span></div>
                  <div class="inputs">
                    <div class="field"><label>Systolic BP</label><input name="sbp" type="number" placeholder="mmHg"></div>
                    <div class="field"><label>Diastolic BP</label><input name="dbp" type="number" placeholder="mmHg"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üíì Heart</span></div>
                  <div class="inputs">
                    <div class="field"><label>Resting Heart Rate</label><input name="resting_hr" type="number" placeholder="bpm"></div>
                    <div class="field"><label>HRV (if known)</label><input name="hrv" type="number" placeholder="ms"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üìè Body Measurements</span></div>
                  <div class="inputs">
                    <div class="field"><label>Weight</label><input name="weight_kg" type="number" step="0.1" placeholder="kg"></div>
                    <div class="field"><label>Height</label><input name="height_cm" type="number" placeholder="cm"></div>
                    <div class="field"><label>Waist</label><input name="waist_cm" type="number" placeholder="cm"></div>
                    <div class="field"><label>Hip</label><input name="hip_cm" type="number" placeholder="cm"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üå°Ô∏è Other Vitals</span></div>
                  <div class="inputs">
                    <div class="field"><label>Body Temperature</label><input name="body_temp" type="number" step="0.1" placeholder="¬∞F"></div>
                    <div class="field"><label>SpO2</label><input name="spo2" type="number" placeholder="%"></div>
                    <div class="field"><label>Respiratory Rate</label><input name="resp_rate" type="number" placeholder="breaths/min"></div>
                  </div>
                </div>
              </div>
              
              <!-- STEP 3: MEDICAL HISTORY -->
              <div class="form-section" data-step="3">
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üè• Past Medical History</span></div>
                  <div class="chip-select" id="pmh-select">
                    <div class="chip" data-value="diabetes_t2">Type 2 Diabetes</div>
                    <div class="chip" data-value="hypertension">Hypertension</div>
                    <div class="chip" data-value="heart_disease">Heart Disease</div>
                    <div class="chip" data-value="stroke">Stroke</div>
                    <div class="chip" data-value="cancer">Cancer</div>
                    <div class="chip" data-value="autoimmune">Autoimmune</div>
                    <div class="chip" data-value="thyroid">Thyroid Disorder</div>
                    <div class="chip" data-value="kidney">Kidney Disease</div>
                    <div class="chip" data-value="liver">Liver Disease</div>
                    <div class="chip" data-value="copd">COPD/Asthma</div>
                    <div class="chip" data-value="depression">Depression</div>
                    <div class="chip" data-value="anxiety">Anxiety</div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üíä Current Medications</span></div>
                  <div class="inputs single">
                    <div class="field"><label>List medications (name, dose, frequency)</label><textarea name="medications" rows="3" placeholder="e.g., Metformin 500mg twice daily, Lisinopril 10mg once daily"></textarea></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üåø Supplements</span></div>
                  <div class="inputs single">
                    <div class="field"><label>List supplements (name, dose)</label><textarea name="supplements" rows="2" placeholder="e.g., Vitamin D3 5000IU daily, Fish Oil 1000mg"></textarea></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">‚ö†Ô∏è Allergies</span></div>
                  <div class="inputs single">
                    <div class="field"><label>Drug & Food Allergies</label><input name="allergies" type="text" placeholder="e.g., Penicillin, Shellfish, Peanuts"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üë®‚Äçüë©‚Äçüëß Family History</span></div>
                  <div class="chip-select" id="fmh-select">
                    <div class="chip" data-value="fh_heart">Heart Disease</div>
                    <div class="chip" data-value="fh_diabetes">Diabetes</div>
                    <div class="chip" data-value="fh_cancer">Cancer</div>
                    <div class="chip" data-value="fh_stroke">Stroke</div>
                    <div class="chip" data-value="fh_hypertension">Hypertension</div>
                    <div class="chip" data-value="fh_alzheimers">Alzheimer's</div>
                    <div class="chip" data-value="fh_autoimmune">Autoimmune</div>
                  </div>
                </div>
              </div>
              
              <!-- STEP 4: LIFESTYLE -->
              <div class="form-section" data-step="4">
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üö¨ Substances</span></div>
                  <div class="inputs">
                    <div class="field">
                      <label>Smoking Status</label>
                      <select name="smoking">
                        <option value="">Select...</option>
                        <option value="never">Never</option>
                        <option value="former">Former (quit)</option>
                        <option value="current">Current</option>
                      </select>
                    </div>
                    <div class="field">
                      <label>Alcohol Use</label>
                      <select name="alcohol">
                        <option value="">Select...</option>
                        <option value="none">None</option>
                        <option value="occasional">Occasional (<4/week)</option>
                        <option value="moderate">Moderate (4-14/week)</option>
                        <option value="heavy">Heavy (>14/week)</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">ü•ó Diet</span></div>
                  <div class="inputs">
                    <div class="field">
                      <label>Diet Type</label>
                      <select name="diet_type">
                        <option value="">Select...</option>
                        <option value="omnivore">Omnivore</option>
                        <option value="vegetarian">Vegetarian</option>
                        <option value="vegan">Vegan</option>
                        <option value="keto">Keto/Low Carb</option>
                        <option value="mediterranean">Mediterranean</option>
                        <option value="paleo">Paleo</option>
                      </select>
                    </div>
                    <div class="field">
                      <label>Processed Food</label>
                      <select name="processed_food">
                        <option value="">Select...</option>
                        <option value="rarely">Rarely</option>
                        <option value="sometimes">Sometimes</option>
                        <option value="often">Often</option>
                        <option value="daily">Daily</option>
                      </select>
                    </div>
                  </div>
                  <div class="inputs" style="margin-top:12px;">
                    <div class="field"><label>Water (cups/day)</label><input name="water_intake" type="number" placeholder="8"></div>
                    <div class="field"><label>Caffeine (cups/day)</label><input name="caffeine" type="number" placeholder="2"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üèÉ Activity</span></div>
                  <div class="inputs">
                    <div class="field">
                      <label>Exercise Frequency</label>
                      <select name="exercise_freq">
                        <option value="">Select...</option>
                        <option value="none">None</option>
                        <option value="1-2">1-2x per week</option>
                        <option value="3-4">3-4x per week</option>
                        <option value="5+">5+ per week</option>
                        <option value="daily">Daily</option>
                      </select>
                    </div>
                    <div class="field"><label>Daily Steps</label><input name="daily_steps" type="number" placeholder="Average"></div>
                  </div>
                  <div class="inputs" style="margin-top:12px;">
                    <div class="field"><label>Hours Sitting/Day</label><input name="sitting_hours" type="number" placeholder="8"></div>
                    <div class="field"><label>Sleep Hours</label><input name="sleep_hours" type="number" step="0.5" placeholder="7"></div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üò∞ Stress Level</span></div>
                  <div class="slider-container">
                    <input type="range" class="slider" name="stress_level" min="1" max="10" value="5">
                    <div class="slider-labels"><span>Low (1)</span><span>Moderate (5)</span><span>High (10)</span></div>
                  </div>
                </div>
              </div>
              
              <!-- STEP 5: SYMPTOMS -->
              <div class="form-section" data-step="5">
                <p style="font-size:13px;color:var(--muted);margin-bottom:20px;">Select any symptoms you've experienced in the past month:</p>
                
                <div class="symptom-category">
                  <h5>‚ù§Ô∏è Cardiovascular</h5>
                  <div class="symptom-grid" id="cv-symptoms">
                    <div class="symptom-item" data-symptom="chest_pain">Chest Pain</div>
                    <div class="symptom-item" data-symptom="palpitations">Palpitations</div>
                    <div class="symptom-item" data-symptom="shortness_breath">Shortness of Breath</div>
                    <div class="symptom-item" data-symptom="leg_swelling">Leg Swelling</div>
                    <div class="symptom-item" data-symptom="dizziness">Dizziness</div>
                  </div>
                </div>
                
                <div class="symptom-category">
                  <h5>ü´Å Respiratory</h5>
                  <div class="symptom-grid">
                    <div class="symptom-item" data-symptom="cough">Cough</div>
                    <div class="symptom-item" data-symptom="wheezing">Wheezing</div>
                    <div class="symptom-item" data-symptom="breathing_difficulty">Difficulty Breathing</div>
                  </div>
                </div>
                
                <div class="symptom-category">
                  <h5>ü´É Gastrointestinal</h5>
                  <div class="symptom-grid">
                    <div class="symptom-item" data-symptom="nausea">Nausea</div>
                    <div class="symptom-item" data-symptom="abdominal_pain">Abdominal Pain</div>
                    <div class="symptom-item" data-symptom="bloating">Bloating</div>
                    <div class="symptom-item" data-symptom="constipation">Constipation</div>
                    <div class="symptom-item" data-symptom="diarrhea">Diarrhea</div>
                    <div class="symptom-item" data-symptom="heartburn">Heartburn</div>
                  </div>
                </div>
                
                <div class="symptom-category">
                  <h5>üß† Neurological</h5>
                  <div class="symptom-grid">
                    <div class="symptom-item" data-symptom="headaches">Headaches</div>
                    <div class="symptom-item" data-symptom="numbness">Numbness/Tingling</div>
                    <div class="symptom-item" data-symptom="memory_issues">Memory Issues</div>
                    <div class="symptom-item" data-symptom="vision_changes">Vision Changes</div>
                  </div>
                </div>
                
                <div class="symptom-category">
                  <h5>ü¶¥ Musculoskeletal</h5>
                  <div class="symptom-grid">
                    <div class="symptom-item" data-symptom="joint_pain">Joint Pain</div>
                    <div class="symptom-item" data-symptom="back_pain">Back Pain</div>
                    <div class="symptom-item" data-symptom="muscle_aches">Muscle Aches</div>
                    <div class="symptom-item" data-symptom="stiffness">Stiffness</div>
                  </div>
                </div>
                
                <div class="symptom-category">
                  <h5>üò¥ General</h5>
                  <div class="symptom-grid">
                    <div class="symptom-item" data-symptom="fatigue">Fatigue</div>
                    <div class="symptom-item" data-symptom="weight_change">Unexplained Weight Change</div>
                    <div class="symptom-item" data-symptom="night_sweats">Night Sweats</div>
                    <div class="symptom-item" data-symptom="fever">Fever/Chills</div>
                    <div class="symptom-item" data-symptom="appetite_loss">Loss of Appetite</div>
                  </div>
                </div>
                
                <div class="symptom-category">
                  <h5>üßò Mental Health</h5>
                  <div class="symptom-grid">
                    <div class="symptom-item" data-symptom="anxiety">Anxiety</div>
                    <div class="symptom-item" data-symptom="depression">Low Mood</div>
                    <div class="symptom-item" data-symptom="insomnia">Insomnia</div>
                    <div class="symptom-item" data-symptom="irritability">Irritability</div>
                  </div>
                </div>
                
                <div class="sec" style="margin-top:20px;">
                  <div class="field">
                    <label>Other Symptoms</label>
                    <textarea name="other_symptoms" rows="2" placeholder="Describe any other symptoms..."></textarea>
                  </div>
                </div>
              </div>
              
              <!-- STEP 6: DEMOGRAPHICS -->
              <div class="form-section" data-step="6">
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üë§ Basic Info</span></div>
                  <div class="inputs">
                    <div class="field"><label>Age</label><input name="age" type="number" placeholder="years"></div>
                    <div class="field">
                      <label>Biological Sex</label>
                      <select name="is_female">
                        <option value="">Select...</option>
                        <option value="false">Male</option>
                        <option value="true">Female</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">üåç Background</span></div>
                  <div class="inputs single">
                    <div class="field">
                      <label>Race/Ethnicity</label>
                      <select name="ethnicity">
                        <option value="">Select...</option>
                        <option value="white">White/Caucasian</option>
                        <option value="black">Black/African American</option>
                        <option value="hispanic">Hispanic/Latino</option>
                        <option value="asian">Asian</option>
                        <option value="native">Native American</option>
                        <option value="pacific">Pacific Islander</option>
                        <option value="mixed">Mixed/Multiple</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                  </div>
                  <div class="inputs" style="margin-top:12px;">
                    <div class="field"><label>ZIP Code</label><input name="zip_code" type="text" placeholder="For provider matching"></div>
                    <div class="field">
                      <label>Living Altitude</label>
                      <select name="altitude">
                        <option value="">Select...</option>
                        <option value="sea">Sea Level</option>
                        <option value="low">Low (<3000ft)</option>
                        <option value="moderate">Moderate (3000-6000ft)</option>
                        <option value="high">High (>6000ft)</option>
                      </select>
                    </div>
                  </div>
                </div>
                <div class="sec">
                  <div class="sec-head"><span class="sec-title">‚úàÔ∏è Recent Travel</span></div>
                  <div class="inputs single">
                    <div class="field"><label>International travel (past 6 months)</label><input name="recent_travel" type="text" placeholder="Countries visited..."></div>
                  </div>
                </div>
              </div>
            </form>
            
            <div style="display:flex;gap:12px;margin-top:24px;">
              <button class="btn btn-secondary" style="flex:1;" onclick="prevStep()" id="prevBtn" disabled>‚Üê Back</button>
              <button class="btn btn-primary" style="flex:1;" onclick="nextStep()" id="nextBtn">Next ‚Üí</button>
            </div>
            <button class="btn btn-coral" style="width:100%;margin-top:12px;" onclick="analyze()">üî¨ Analyze Health Profile</button>
          </div>
        </div>
      </aside>

      <section class="results">
        <div id="empty" class="card empty">
          <div class="empty-icon">üß¨</div>
          <h3>Build Your Health Profile</h3>
          <p>Enter your biomarkers and health data. We'll synthesize physiological states and show exactly what traditional labs would reveal.</p>
        </div>
        <div id="resultsContent" class="hidden"></div>
      </section>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-links">
        <a href="https://monitor-api.abedelhamdan.workers.dev/schema">API Schema</a>
        <a href="https://monitor-api.abedelhamdan.workers.dev/citations">Citations</a>
        <a href="https://github.com/bob56565/monitor-backend">GitHub</a>
      </div>
      <p class="disclaimer-footer">For educational purposes only. Not medical advice. Always consult a qualified healthcare provider for diagnosis and treatment decisions. Monitor Health v3.8.0</p>
    </div>
  </footer>

  <!-- METRIC DETAIL MODAL -->
  <div class="metric-detail" id="metricModal">
    <div class="metric-modal" id="metricModalContent">
      <button class="close-modal" onclick="closeMetricModal()">√ó</button>
      <!-- Dynamic content inserted here -->
    </div>
  </div>

  <script>
    const API = 'https://monitor-api.abedelhamdan.workers.dev';
    let lastAnalysisData = null;
    let currentStep = 1;
    const totalSteps = 6;
    let selectedSymptoms = [];
    let selectedPMH = [];
    let selectedFMH = [];
    
    // WIZARD NAVIGATION
    document.querySelectorAll('.wizard-step').forEach(step => {
      step.addEventListener('click', () => {
        const stepNum = parseInt(step.dataset.step);
        goToStep(stepNum);
      });
    });
    
    function goToStep(step) {
      currentStep = step;
      updateWizard();
    }
    
    function nextStep() {
      if (currentStep < totalSteps) {
        currentStep++;
        updateWizard();
      }
    }
    
    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateWizard();
      }
    }
    
    function updateWizard() {
      document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
      document.querySelector(`.form-section[data-step="${currentStep}"]`).classList.add('active');
      
      document.querySelectorAll('.wizard-step').forEach(s => {
        const stepNum = parseInt(s.dataset.step);
        s.classList.remove('active', 'completed');
        if (stepNum === currentStep) s.classList.add('active');
        else if (stepNum < currentStep) s.classList.add('completed');
      });
      
      document.getElementById('prevBtn').disabled = currentStep === 1;
      document.getElementById('nextBtn').textContent = currentStep === totalSteps ? '‚úì Done' : 'Next ‚Üí';
      document.getElementById('progress-badge').textContent = `Step ${currentStep}/${totalSteps}`;
    }
    
    // CHIP SELECTS
    document.querySelectorAll('.chip').forEach(chip => {
      chip.addEventListener('click', () => {
        chip.classList.toggle('selected');
        const value = chip.dataset.value;
        const parent = chip.closest('.chip-select');
        
        if (parent.id === 'pmh-select') {
          if (chip.classList.contains('selected')) selectedPMH.push(value);
          else selectedPMH = selectedPMH.filter(v => v !== value);
        } else if (parent.id === 'fmh-select') {
          if (chip.classList.contains('selected')) selectedFMH.push(value);
          else selectedFMH = selectedFMH.filter(v => v !== value);
        }
      });
    });
    
    // SYMPTOM SELECTS
    document.querySelectorAll('.symptom-item').forEach(item => {
      item.addEventListener('click', () => {
        item.classList.toggle('selected');
        const symptom = item.dataset.symptom;
        if (item.classList.contains('selected')) selectedSymptoms.push(symptom);
        else selectedSymptoms = selectedSymptoms.filter(s => s !== symptom);
      });
    });
    
    function scrollToForm() {
      document.querySelector('.sidebar').scrollIntoView({ behavior: 'smooth' });
    }
    
    function loadDemo() {
      const d = {
        total_cholesterol: 220, hdl: 42, triglycerides: 185,
        fasting_glucose: 108, fasting_insulin: 15, hba1c: 5.9,
        age: 45, creatinine: 1.1, weight_kg: 85, height_cm: 175,
        waist_cm: 98, sbp: 138, dbp: 88, hscrp: 2.8,
        alt: 35, ast: 28, ferritin: 180, hemoglobin: 14.5
      };
      for (const [k, v] of Object.entries(d)) {
        const el = document.querySelector(`[name="${k}"]`);
        if (el) el.value = v;
      }
      analyze();
    }
    
    async function analyze() {
      const form = document.getElementById('healthForm');
      const data = {};
      
      // Collect form data
      new FormData(form).forEach((v, k) => {
        if (k === 'is_female') data[k] = v === 'true';
        else if (v && !isNaN(parseFloat(v))) data[k] = parseFloat(v);
        else if (v) data[k] = v;
      });
      
      // Add selected items
      if (selectedPMH.length) data.pmh = selectedPMH;
      if (selectedFMH.length) data.fmh = selectedFMH;
      if (selectedSymptoms.length) data.symptoms = selectedSymptoms;
      
      if (Object.keys(data).length < 3) return alert('Please enter at least 3 values');
      
      try {
        const res = await fetch(`${API}/analyze?mode=a2`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const json = await res.json();
        lastAnalysisData = json;
        render(json);
      } catch (e) { alert('Error: ' + e.message); }
    }
    
    function render(data) {
      document.getElementById('empty').classList.add('hidden');
      const el = document.getElementById('resultsContent');
      el.classList.remove('hidden');
      
      let html = '';
      
      // EXECUTIVE SUMMARY
      html += `
        <div class="exec-summary reveal">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;">
            <div>
              <h2>${data.executive_summary?.headline || 'Analysis Complete'}</h2>
              <p>Comprehensive assessment from ${data.cascade_result?.inputs || 0} inputs</p>
            </div>
            <button class="btn btn-coral" onclick="generatePDF()">üìÑ Download PDF</button>
          </div>
          <div class="exec-stats">
            <div class="stat-item"><div class="stat-num">${data.cascade_result?.inputs || 0}</div><div class="stat-label">Inputs</div></div>
            <div class="stat-item"><div class="stat-num">${data.cascade_result?.calculated || 0}</div><div class="stat-label">Calculated</div></div>
            <div class="stat-item"><div class="stat-num">${data.cascade_result?.total || 0}</div><div class="stat-label">Total Insights</div></div>
          </div>
      `;
      
      if (data.executive_summary?.key_findings?.length) {
        html += `<div class="key-findings"><h4>üéØ Key Findings</h4>`;
        data.executive_summary.key_findings.forEach(f => {
          const sev = f.severity || 'normal';
          const badgeClass = sev === 'high' ? 'badge-high' : sev === 'elevated' || sev === 'review' ? 'badge-moderate' : sev === 'warning' ? 'badge-review' : 'badge-normal';
          html += `<div class="finding-item"><span class="finding-badge ${badgeClass}">${sev}</span><span>${f.finding}</span></div>`;
        });
        html += `</div>`;
      }
      html += `</div>`;
      
      // COVERAGE DASHBOARD WITH FLIP EXPLANATIONS
      if (data.coverage?.by_category) {
        html += `
          <div class="collapsible open reveal">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
              <h3><span class="icon">üìä</span> Coverage Dashboard <span style="font-weight:400;color:var(--muted);margin-left:12px;">${data.coverage.completeness || 0}% complete</span></h3>
              <span class="arrow">‚ñº</span>
            </div>
            <div class="collapsible-body">
              <p style="color:var(--muted);margin-bottom:20px;font-size:14px;">Click any category to learn what it measures and why it matters for your health.</p>
              <div class="coverage-grid">
        `;
        const catIcons = {lipid:'üíâ',glycemic:'üç¨',kidney:'ü¶¥',liver:'ü´Ä',inflammatory:'üî¨',thyroid:'ü¶ã',anemia:'ü©∏',metabolic:'‚öñÔ∏è',cardiac:'‚ù§Ô∏è',nutritional:'üíä',demographics:'üë§'};
        const catExplanations = {
          lipid: { title: 'Lipid Panel', desc: 'Blood fats affecting cardiovascular health. Clinicians monitor total cholesterol, LDL, HDL, and triglycerides to assess heart disease and stroke risk.', impact: 'Abnormal lipids contribute to arterial plaque buildup - the leading cause of heart attacks.' },
          glycemic: { title: 'Blood Sugar', desc: 'Measures how your body regulates glucose. Key markers include fasting glucose, HbA1c, and insulin levels.', impact: 'Dysregulation leads to diabetes, affecting nearly every organ system over time.' },
          kidney: { title: 'Kidney Function', desc: 'Assesses your kidneys\' ability to filter waste. Creatinine, BUN, and eGFR are primary markers.', impact: 'Kidney damage is often silent until advanced - early detection enables intervention.' },
          liver: { title: 'Liver Health', desc: 'Evaluates liver cell health and function. ALT, AST, and GGT indicate stress or damage.', impact: 'The liver processes medications, filters toxins, and produces essential proteins.' },
          inflammatory: { title: 'Inflammation', desc: 'Measures systemic inflammation levels. hs-CRP and ferritin are key indicators.', impact: 'Chronic inflammation underlies most chronic diseases including heart disease and cancer.' },
          thyroid: { title: 'Thyroid Function', desc: 'Assesses metabolic regulation. TSH is the primary screening marker.', impact: 'Thyroid disorders affect metabolism, energy, weight, and mood.' },
          cardiac: { title: 'Blood Pressure', desc: 'Measures force of blood against artery walls. Systolic/diastolic readings are essential.', impact: 'Hypertension is the #1 modifiable risk factor for stroke and heart disease.' }
        };
        
        for (const [cat, info] of Object.entries(data.coverage.by_category)) {
          if (!info.provided?.length && !info.missing?.length) continue;
          const pct = Math.round((info.completeness || 0) * 100);
          const fillClass = pct >= 70 ? 'high' : pct >= 40 ? 'medium' : 'low';
          const exp = catExplanations[cat] || { title: cat, desc: 'Health markers in this category.', impact: 'Important for overall health assessment.' };
          
          html += `
            <div class="coverage-item" onclick="toggleCoverageExplanation(this)">
              <h4>${catIcons[cat] || 'üìã'} ${cat}</h4>
              <div class="coverage-bar"><div class="coverage-fill ${fillClass}" style="width:${pct}%"></div></div>
              <div class="coverage-stats"><span>${pct}%</span><span>${info.provided?.length || 0}/${(info.provided?.length || 0) + (info.missing?.length || 0)}</span></div>
              <div class="coverage-detail">
                ${info.provided?.length ? `<div class="provided">‚úì ${info.provided.map(formatName).join(', ')}</div>` : ''}
                ${info.missing?.length ? `<div class="missing">Missing: ${info.missing.slice(0,3).map(formatName).join(', ')}${info.missing.length > 3 ? '...' : ''}</div>` : ''}
              </div>
              <div class="coverage-explanation">
                <span class="close-btn" onclick="event.stopPropagation();this.closest('.coverage-item').classList.remove('show-explanation')">‚úï</span>
                <h4>${exp.title}</h4>
                <p><strong>What it measures:</strong> ${exp.desc}</p>
                <p style="margin-top:8px;"><strong>Why it matters:</strong> ${exp.impact}</p>
              </div>
            </div>
          `;
        }
        html += `</div></div></div>`;
      }
      
      // UNLOCK OPPORTUNITIES WITH IMPACT EXPLANATION
      if (data.unlock_opportunities?.length) {
        html += `
          <div class="collapsible reveal">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
              <h3><span class="icon">üîì</span> Unlock Opportunities</h3>
              <span class="arrow">‚ñº</span>
            </div>
            <div class="collapsible-body">
              <div style="background:var(--bg);padding:16px 20px;border-radius:12px;margin-bottom:20px;">
                <h4 style="font-size:13px;font-weight:700;margin-bottom:8px;">üìä What is Impact Score?</h4>
                <p style="font-size:13px;color:var(--muted);line-height:1.6;">Impact Score (0-10) measures how much adding a test improves your health insights. Higher scores = more calculations unlocked, better confidence in assessments, and more actionable findings. <strong>8-10:</strong> Strongly recommended. <strong>5-7:</strong> Valuable addition. <strong>1-4:</strong> Nice to have.</p>
              </div>
              <div class="tier-grid">
        `;
        data.unlock_opportunities.slice(0, 8).forEach(u => {
          const impactColor = u.impact_score >= 8 ? 'var(--sage)' : u.impact_score >= 5 ? 'var(--gold)' : 'var(--muted)';
          html += `
            <div class="tier-item" onclick="toggleTierExplanation(this)">
              <div class="tier-item-name">Add Test</div>
              <div class="tier-item-value" style="font-size:18px;">${formatName(u.input)}</div>
              <div style="display:flex;justify-content:space-between;align-items:center;">
                <span class="tier-item-tag tag-neutral">+${u.unlocks_count} insights</span>
                <span style="font-weight:700;color:${impactColor};">‚ö°${u.impact_score.toFixed(1)}</span>
              </div>
              <div class="tier-item-explanation">
                <h5>Why Add ${formatName(u.input)}?</h5>
                <p>Unlocks ${u.unlocks_count} new calculations:</p>
                <ul style="margin:8px 0 0 16px;font-size:11px;">
                  ${u.outputs.slice(0,4).map(o => `<li>${formatName(o.output)}</li>`).join('')}
                </ul>
                <p style="margin-top:8px;">Impact: ${u.impact_score >= 8 ? 'High - strongly recommended' : u.impact_score >= 5 ? 'Moderate - valuable addition' : 'Low-moderate'}</p>
              </div>
            </div>
          `;
        });
        html += `</div></div></div>`;
      }
      
      // PHYSIOLOGICAL STATES WITH RANGE EXPLANATIONS
      if (data.physiological_states) {
        const evaluatedStates = Object.entries(data.physiological_states).filter(([k, s]) => s.evaluated);
        if (evaluatedStates.length) {
          html += `
            <div class="collapsible open reveal">
              <div class="collapsible-header" onclick="toggleCollapsible(this)">
                <h3><span class="icon">ü´Ä</span> Physiological States</h3>
                <span class="arrow">‚ñº</span>
              </div>
              <div class="collapsible-body">
                <p style="color:var(--muted);margin-bottom:20px;">Each state synthesizes multiple biomarkers. Click values to understand what they mean.</p>
                <div class="states-grid">
          `;
          evaluatedStates.forEach(([k, s]) => {
            const cls = s.score > 70 ? 'ok' : 'warn';
            const ico = s.score > 70 ? '‚úì' : '!';
            html += `
              <div class="card state-card">
                <div class="state-header">
                  <div class="state-icon ${cls}">${ico}</div>
                  <div>
                    <div class="state-name">${s.name}</div>
                    <div class="state-value">${(s.state||'').replace(/_/g,' ')}</div>
                    <div class="state-factors">${(s.factors||[]).slice(0,2).join(' ‚Ä¢ ')||'No concerns'}</div>
                    <div class="state-score">Score: ${s.score}/100</div>
                  </div>
                </div>
              </div>
            `;
          });
          html += `</div></div></div>`;
        }
      }
      
      // DERIVED VALUES BY TIER WITH EXPLANATIONS
      if (data.derived_by_tier) {
        html += `
          <div class="collapsible reveal">
            <div class="collapsible-header" onclick="toggleCollapsible(this)">
              <h3><span class="icon">üìê</span> All Derived Values</h3>
              <span class="arrow">‚ñº</span>
            </div>
            <div class="collapsible-body">
        `;
        
        // Tier explanations
        const tierInfo = {
          tier1: { name: 'Direct Measures', badge: 'tier-1', desc: 'Values directly from your inputs (e.g., BMI from height/weight). These form the foundation of analysis.' },
          tier2: { name: 'Derived Calculations', badge: 'tier-2', desc: 'Ratios and indices calculated from multiple inputs (e.g., HOMA-IR from glucose + insulin). Reveal relationships single values can\'t show.' },
          tier3: { name: 'Physiological Proxies', badge: 'tier-3', desc: 'Inferred physiological states from pattern analysis. These correlate with what specialized lab tests would show.' }
        };
        
        // Tier 1
        if (data.derived_by_tier.tier1_direct?.length) {
          html += `
            <div class="tier-section" onclick="toggleTierSection(this)">
              <div class="tier-header">
                <span class="tier-badge ${tierInfo.tier1.badge}">Tier 1</span>
                <h4>${tierInfo.tier1.name}</h4>
                <span class="tier-count">${data.derived_by_tier.tier1_direct.length} values</span>
              </div>
              <div class="tier-explanation">${tierInfo.tier1.desc}</div>
              <div class="tier-grid">
          `;
          data.derived_by_tier.tier1_direct.forEach(d => {
            const val = typeof d.value === 'number' ? d.value.toFixed(2) : d.value;
            const risk = d.interpretation?.risk;
            const tagClass = risk === 'high' || risk === 'elevated' ? 'tag-warn' : risk === 'normal' || risk === 'optimal' ? 'tag-ok' : 'tag-neutral';
            html += `
              <div class="tier-item" onclick="event.stopPropagation();toggleTierExplanation(this)">
                <div class="tier-item-name">${formatName(d.name)}</div>
                <div class="tier-item-value">${val}</div>
                ${risk ? `<span class="tier-item-tag ${tagClass}">${risk}</span>` : ''}
                <div class="tier-item-explanation">
                  <h5>${formatName(d.name)}</h5>
                  <p>Value: ${val}</p>
                  <div class="range">
                    <strong>Interpretation:</strong> ${risk || 'Calculated'}<br>
                    <span style="font-size:10px;opacity:0.8;">Click outside to close</span>
                  </div>
                </div>
              </div>
            `;
          });
          html += `</div></div>`;
        }
        
        // Tier 2
        const tier2 = [...(data.derived_by_tier.tier2_derived || []), ...(data.derived_by_tier.other || [])];
        if (tier2.length) {
          html += `
            <div class="tier-section" onclick="toggleTierSection(this)">
              <div class="tier-header">
                <span class="tier-badge ${tierInfo.tier2.badge}">Tier 2</span>
                <h4>${tierInfo.tier2.name}</h4>
                <span class="tier-count">${tier2.length} values</span>
              </div>
              <div class="tier-explanation">${tierInfo.tier2.desc}</div>
              <div class="tier-grid">
          `;
          tier2.forEach(d => {
            const val = typeof d.value === 'number' ? d.value.toFixed(2) : (typeof d.value === 'object' ? (d.value.state || JSON.stringify(d.value)) : d.value);
            const risk = d.interpretation?.risk;
            const tagClass = risk === 'high' || risk === 'elevated' ? 'tag-warn' : risk === 'normal' || risk === 'optimal' || risk === 'low' ? 'tag-ok' : 'tag-neutral';
            html += `
              <div class="tier-item" onclick="event.stopPropagation();toggleTierExplanation(this)">
                <div class="tier-item-name">${formatName(d.name)}</div>
                <div class="tier-item-value" style="font-size:${String(val).length > 8 ? '18px' : '26px'};">${val}</div>
                ${risk ? `<span class="tier-item-tag ${tagClass}">${risk}</span>` : ''}
                <div class="tier-item-explanation">
                  <h5>${formatName(d.name)}</h5>
                  <p>Value: ${val}</p>
                  ${d.citation ? `<p style="margin-top:6px;font-size:10px;">Source: ${d.citation.source}</p>` : ''}
                </div>
              </div>
            `;
          });
          html += `</div></div>`;
        }
        
        // Tier 3
        if (data.derived_by_tier.tier3_proxy?.length) {
          html += `
            <div class="tier-section" onclick="toggleTierSection(this)">
              <div class="tier-header">
                <span class="tier-badge ${tierInfo.tier3.badge}">Tier 3</span>
                <h4>${tierInfo.tier3.name}</h4>
                <span class="tier-count">${data.derived_by_tier.tier3_proxy.length} values</span>
              </div>
              <div class="tier-explanation">${tierInfo.tier3.desc}</div>
              <div class="tier-grid">
          `;
          data.derived_by_tier.tier3_proxy.forEach(d => {
            const val = typeof d.value === 'object' ? (d.value.state || d.value.likelihood || JSON.stringify(d.value)) : d.value;
            const isWarn = typeof d.value === 'object' && ['elevated', 'likely_resistant', 'strained', 'deficient'].includes(d.value?.state);
            html += `
              <div class="tier-item" onclick="event.stopPropagation();toggleTierExplanation(this)">
                <div class="tier-item-name">${formatName(d.name)}</div>
                <div class="tier-item-value" style="font-size:16px;">${val}</div>
                <span class="tier-item-tag ${isWarn ? 'tag-warn' : 'tag-ok'}">${isWarn ? 'Review' : 'OK'}</span>
                <div class="tier-item-explanation">
                  <h5>${formatName(d.name)}</h5>
                  <p>Assessment: ${val}</p>
                  <p style="margin-top:6px;">This is a physiological proxy - discuss with your provider.</p>
                </div>
              </div>
            `;
          });
          html += `</div></div>`;
        }
        
        html += `</div></div>`;
      }
      
      // KEY METRICS WITH RECOMMENDATIONS
      const metrics = ['bmi','homa_ir','egfr','ldl','hdl','triglycerides','fasting_glucose','hba1c'];
      const shown = metrics.filter(m => data.values?.[m] !== undefined && typeof data.values[m] === 'number');
      if (shown.length) {
        html += `
          <div class="reveal">
            <div class="section-header"><h2>Key Metrics</h2><p>Click any metric for detailed insights and recommendations</p></div>
            <div class="metrics-grid">
        `;
        for (const m of shown) {
          const v = data.values[m];
          const display = v > 100 ? Math.round(v) : v.toFixed(1);
          const interp = getInterp(m, v);
          html += `
            <div class="metric" onclick="showMetricDetail('${m}', ${v})">
              <div class="metric-label">${formatName(m)}</div>
              <div class="metric-value">${display}</div>
              <span class="metric-tag tag-${interp.cls}">${interp.label}</span>
              <div class="metric-expand">Click for details ‚Üí</div>
            </div>
          `;
        }
        html += `</div></div>`;
      }
      
      el.innerHTML = html;
      
      // Trigger scroll reveal animations
      setTimeout(() => {
        document.querySelectorAll('.reveal').forEach((el, i) => {
          setTimeout(() => el.classList.add('visible'), i * 100);
        });
      }, 100);
    }
    
    function toggleCollapsible(el) {
      el.closest('.collapsible').classList.toggle('open');
    }
    
    function toggleCoverageExplanation(el) {
      el.classList.toggle('show-explanation');
    }
    
    function toggleTierSection(el) {
      el.classList.toggle('show-explanation');
    }
    
    function toggleTierExplanation(el) {
      el.classList.toggle('show-explanation');
    }
    
    function showMetricDetail(metric, value) {
      const modal = document.getElementById('metricModal');
      const content = document.getElementById('metricModalContent');
      
      const details = getMetricDetails(metric, value);
      
      content.innerHTML = `
        <button class="close-modal" onclick="closeMetricModal()">√ó</button>
        <h3>${details.name}</h3>
        <div class="value">${details.display}</div>
        <span class="metric-tag tag-${details.status.cls}" style="margin-bottom:24px;display:inline-block;">${details.status.label}</span>
        
        <section>
          <h4>üí° Why This Matters</h4>
          <p>${details.explanation}</p>
        </section>
        
        <section>
          <h4>‚ö° Recommended Actions</h4>
          <ul style="margin-left:20px;">
            ${details.actions.map(a => `<li style="margin-bottom:8px;">${a}</li>`).join('')}
          </ul>
        </section>
        
        <section>
          <h4>üè• Provider Recommendations</h4>
          <div class="provider-list">
            ${details.providers.map(p => `
              <div class="provider-item">
                <div class="provider-icon">${p.icon}</div>
                <div class="provider-info">
                  <h5>${p.name}</h5>
                  <p>${p.type}</p>
                </div>
                <div class="provider-rating">‚≠ê ${p.rating}</div>
              </div>
            `).join('')}
          </div>
          <p style="font-size:12px;color:var(--muted);margin-top:12px;">Enter your ZIP code in the form for localized recommendations</p>
        </section>
        
        <section>
          <h4>üõí Products & Tools</h4>
          <div class="product-grid">
            ${details.products.map(p => `
              <div class="product-item">
                <div class="icon">${p.icon}</div>
                <h5>${p.name}</h5>
                <p>${p.desc}</p>
                ${p.discount ? `<div class="discount">${p.discount}</div>` : ''}
              </div>
            `).join('')}
          </div>
        </section>
        
        <section>
          <h4>üìö Learn More</h4>
          <div class="resource-links">
            ${details.resources.map(r => `<a href="${r.url}" target="_blank" class="resource-link">${r.name}</a>`).join('')}
          </div>
        </section>
      `;
      
      modal.classList.add('show');
    }
    
    function closeMetricModal() {
      document.getElementById('metricModal').classList.remove('show');
    }
    
    function getMetricDetails(metric, value) {
      const base = {
        name: formatName(metric),
        display: value > 100 ? Math.round(value) : value.toFixed(1),
        status: getInterp(metric, value),
        providers: [
          { icon: 'üë®‚Äç‚öïÔ∏è', name: 'Primary Care Physician', type: 'General health assessment', rating: '4.8' },
          { icon: 'üè•', name: 'Specialist Referral', type: 'Based on findings', rating: '4.7' }
        ],
        products: [
          { icon: 'üì±', name: 'Health App', desc: 'Track your metrics', discount: null }
        ],
        resources: [
          { name: 'Learn More', url: '#' }
        ]
      };
      
      // Metric-specific details
      const specifics = {
        bmi: {
          explanation: 'Body Mass Index indicates body fat based on height and weight. While imperfect, elevated BMI correlates with increased risk of heart disease, diabetes, and other conditions.',
          actions: ['Aim for gradual weight loss of 1-2 lbs/week if elevated', 'Focus on whole foods and regular physical activity', 'Consider consulting a registered dietitian'],
          providers: [
            { icon: 'ü•ó', name: 'Registered Dietitian', type: 'Nutrition counseling', rating: '4.9' },
            { icon: 'üèãÔ∏è', name: 'Certified Personal Trainer', type: 'Exercise programming', rating: '4.8' },
            { icon: 'üë®‚Äç‚öïÔ∏è', name: 'Obesity Medicine Specialist', type: 'Medical weight management', rating: '4.7' }
          ],
          products: [
            { icon: '‚öñÔ∏è', name: 'Smart Scale', desc: 'Track weight & body comp', discount: '15% off with HELIX15' },
            { icon: 'üì±', name: 'Noom', desc: 'Psychology-based weight loss', discount: '14-day free trial' },
            { icon: 'üçΩÔ∏è', name: 'Factor Meals', desc: 'Healthy prepared meals', discount: '$120 off first 5 boxes' }
          ],
          resources: [
            { name: 'BMI Calculator', url: 'https://www.cdc.gov/healthyweight/assessing/bmi/' },
            { name: 'Healthy Weight Guide', url: 'https://www.nhlbi.nih.gov/health/educational/lose_wt/' }
          ]
        },
        homa_ir: {
          explanation: 'HOMA-IR measures insulin resistance - how effectively your cells respond to insulin. Elevated values often precede type 2 diabetes by 10-15 years, making early intervention critical.',
          actions: ['Discuss OGTT with your provider for confirmation', 'Implement Mediterranean diet principles', 'Target 150+ minutes moderate exercise weekly', 'Prioritize 7-9 hours quality sleep'],
          providers: [
            { icon: 'üî¨', name: 'Endocrinologist', type: 'Hormone & metabolic specialist', rating: '4.8' },
            { icon: 'üè•', name: 'Diabetes Prevention Program', type: 'Lifestyle intervention', rating: '4.9' },
            { icon: 'üíª', name: 'Virta Health', type: 'Diabetes reversal telehealth', rating: '4.7' }
          ],
          products: [
            { icon: 'üìä', name: 'Dexcom G7 CGM', desc: 'Continuous glucose monitor', discount: '15% off' },
            { icon: 'üíä', name: 'Berberine', desc: 'Natural insulin sensitizer', discount: null },
            { icon: '‚åö', name: 'Levels Health', desc: 'CGM + metabolic coaching', discount: '$25 off' }
          ],
          resources: [
            { name: 'Understanding Insulin Resistance', url: 'https://www.diabetes.org/diabetes/type-2/insulin-resistance' },
            { name: 'PMID:3899825 - HOMA Study', url: 'https://pubmed.ncbi.nlm.nih.gov/3899825/' }
          ]
        },
        ldl: {
          explanation: 'LDL cholesterol carries cholesterol to your arteries. High levels contribute to plaque buildup (atherosclerosis), increasing heart attack and stroke risk.',
          actions: ['Reduce saturated fat intake', 'Increase soluble fiber (oats, beans, fruits)', 'Consider plant sterols/stanols', 'Discuss statin therapy if elevated'],
          providers: [
            { icon: '‚ù§Ô∏è', name: 'Cardiologist', type: 'Heart health specialist', rating: '4.8' },
            { icon: 'üè•', name: 'Lipid Clinic', type: 'Cholesterol management', rating: '4.7' }
          ],
          products: [
            { icon: 'ü´Ä', name: 'Kardia Mobile', desc: 'Portable ECG monitor', discount: null },
            { icon: 'üêü', name: 'Omega-3 Supplements', desc: 'Support heart health', discount: null }
          ],
          resources: [
            { name: 'AHA Cholesterol Guidelines', url: 'https://www.heart.org/en/health-topics/cholesterol' }
          ]
        }
      };
      
      return { ...base, ...(specifics[metric] || { explanation: 'This metric provides insight into your health status.', actions: ['Discuss with your healthcare provider'], providers: base.providers, products: base.products, resources: base.resources }) };
    }
    
    function formatName(n) {
      const names = {bmi:'BMI',homa_ir:'HOMA-IR',egfr:'eGFR',ldl:'LDL',hdl:'HDL',triglycerides:'Triglycerides',fasting_glucose:'Fasting Glucose',hba1c:'HbA1c',hscrp:'hs-CRP',alt:'ALT',ast:'AST',ggt:'GGT',tsh:'TSH',ft4:'Free T4',total_cholesterol:'Total Cholesterol',fasting_insulin:'Fasting Insulin',creatinine:'Creatinine',bun:'BUN',sbp:'Systolic BP',dbp:'Diastolic BP',waist_cm:'Waist',weight_kg:'Weight',height_cm:'Height',age:'Age',tg_hdl_ratio:'TG/HDL',tyg_index:'TyG Index',castelli_1:'Castelli I',castelli_2:'Castelli II',atherogenic_index:'Atherogenic Index',pulse_pressure:'Pulse Pressure',nlr:'NLR',plr:'PLR',fib4:'FIB-4',insulin_sensitivity_proxy:'Insulin Sensitivity',inflammatory_burden_proxy:'Inflammation',cv_resilience_proxy:'CV Resilience',metabolic_stress_state:'Metabolic Stress',hepatic_stress_proxy:'Liver Stress',kidney_stress_proxy:'Kidney Stress',mets_likelihood:'MetS Risk',non_hdl:'Non-HDL',vldl:'VLDL',map:'MAP'};
      return names[n] || n.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }
    
    function getInterp(m, v) {
      const rules = {
        bmi: v => v < 25 ? {cls:'ok',label:'Normal'} : v < 30 ? {cls:'warn',label:'Overweight'} : {cls:'warn',label:'Obese'},
        homa_ir: v => v < 2 ? {cls:'ok',label:'Optimal'} : v < 3 ? {cls:'neutral',label:'Borderline'} : {cls:'warn',label:'Elevated'},
        egfr: v => v > 90 ? {cls:'ok',label:'Normal'} : v > 60 ? {cls:'neutral',label:'Mild ‚Üì'} : {cls:'warn',label:'Reduced'},
        ldl: v => v < 100 ? {cls:'ok',label:'Optimal'} : v < 130 ? {cls:'neutral',label:'Near Optimal'} : {cls:'warn',label:'High'},
        hdl: v => v > 60 ? {cls:'ok',label:'Optimal'} : v > 40 ? {cls:'neutral',label:'Normal'} : {cls:'warn',label:'Low'},
        triglycerides: v => v < 150 ? {cls:'ok',label:'Normal'} : v < 200 ? {cls:'neutral',label:'Borderline'} : {cls:'warn',label:'High'},
        fasting_glucose: v => v < 100 ? {cls:'ok',label:'Normal'} : v < 126 ? {cls:'warn',label:'Prediabetic'} : {cls:'warn',label:'Diabetic'},
        hba1c: v => v < 5.7 ? {cls:'ok',label:'Normal'} : v < 6.5 ? {cls:'warn',label:'Prediabetic'} : {cls:'warn',label:'Diabetic'}
      };
      return rules[m]?.(v) || {cls:'neutral',label:'Measured'};
    }
    
    function generatePDF() {
      if (!lastAnalysisData) return alert('Please analyze first');
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      // [PDF generation code - abbreviated for space]
      doc.setFontSize(20);
      doc.setTextColor(74, 124, 89);
      doc.text('Monitor Health Report v3.8.0', 20, 20);
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 30);
      doc.text(`Inputs: ${lastAnalysisData.cascade_result?.inputs} | Calculated: ${lastAnalysisData.cascade_result?.calculated}`, 20, 40);
      doc.save(`monitor-health-report-${new Date().toISOString().split('T')[0]}.pdf`);
    }
    
    // Close modal on outside click
    document.getElementById('metricModal').addEventListener('click', (e) => {
      if (e.target.id === 'metricModal') closeMetricModal();
    });
  </script>
</body>
</html>
